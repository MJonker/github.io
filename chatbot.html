<html>
<head>
<link href="css/style.css" rel="stylesheet" type="text/css" media="screen">
<script type = "application/javascript">
		var conversationIndex = 1;
		var watsonContext = "";
         function loadJSON(){
        	 
        	var questionText = document.getElementById('input').value;
        	var dialog = new Object();
        	dialog.newQuestion = questionText;
        	
        	var qTOAdd = document.createDocumentFragment();
            var qNnewDiv = document.createElement('div');
            qNnewDiv.id = 'q'+conversationIndex;
            qNnewDiv.className = 'conversationQuestion';
            var qtext = document.createElement('div');
            qtext.innerHTML=questionText;
            qNnewDiv.appendChild(qtext);
            qTOAdd.appendChild(qNnewDiv);
            
            document.getElementById("conversation").appendChild(qTOAdd);
        	
        	
        	//var data_file = "api/talktome?question="+questionText;
        	if (!Object.is(watsonContext,"")) {
        		dialog.context=watsonContext;
        	}
            var http_request = new XMLHttpRequest();
            try{
               // Opera 8.0+, Firefox, Chrome, Safari
               http_request = new XMLHttpRequest();
               
            }catch (e){
               // Internet Explorer Browsers
               try{
                  http_request = new ActiveXObject("Msxml2.XMLHTTP");
					
               }catch (e) {
				
                  try{
                     http_request = new ActiveXObject("Microsoft.XMLHTTP");
                  }catch (e){
                     // Something went wrong
                     alert("Your browser broke!");
                     return false;
                  }
					
               }
            }
			
            http_request.onreadystatechange = function(){
			
               if (http_request.readyState == 4  ){
                  // Javascript function JSON.parse to parse JSON data
                  var jsonObj = JSON.parse(http_request.responseText);
                  console.log(jsonObj);
                  var toAdd = document.createDocumentFragment();
                  //for(var i = 0; i < jsonObj.length; i++) {
                //	    var obj = jsonObj[i];
                	    var newDiv = document.createElement('div');
                        newDiv.id = 'r'+conversationIndex;
                        conversationIndex++;
                        newDiv.className = 'conversation';
                        var text = document.createElement('div');
                        text.innerHTML=jsonObj.text;
                        newDiv.appendChild(text);
                        //var divConversationContext = document.getElementById('conversation_context');
                        //divConversationContext.value=jsonObj.context;
                        watsonContext =jsonObj.context;
                        
                        toAdd.appendChild(newDiv);
               //    }
                  
                  
                  document.getElementById("conversation").appendChild(toAdd);

                  document.getElementById('input').value="";
               }
            }
            var url = "https://eofwatsonsdkusage.mybluemix.net/api/talkdutchtowebsite";
            http_request.open("POST", url, true);
            http_request.setRequestHeader("Content-type", "application/json");
            //http_request.open("GET", data_file, true);
            http_request.send(JSON.stringify(dialog));
         }
		
      </script>
<script type = "application/javascript">
function yesbye() {
	document.getElementById('input').value="yes";
	loadJSON();
}

function nobye(){
	document.getElementById('input').value="no";
	loadJSON();
}

function button(userinput, buttonContext) {
	document.getElementById('input').value=userinput;
	watsonContext.product=buttonContext;
	loadJSON();
}

function openlink(url) {
	var win = window.open(url,'_blank');
	win.focus();
}

function process(e) {
    var code = (e.keyCode ? e.keyCode : e.which);
    if (code == 13) { //Enter keycode
        loadJSON();
    }
}

</script>      
      
      <title>Nederlandstalige Chat</title>
      </head>
<body onload='loadJSON()' >
<h2>Hallo Nederlandstalige Watson</h2>
<div id="conversation">


</div>
<div>
<input type="hidden" id="conversation_context" />
</div>
<div>
<input type="text" id="input" onkeypress="process(event, this)"/>
<button class="askbutton" type="button" onclick="loadJSON()">Ask</button>
</div>
<br>

</body>
</html>
